# linux基础应用

### 课程概览与shell



#### Shell 脚本

+ Bash中的字符串通过`'` 和 `"`分隔符来定义

  + `'$ foo'`其中的变量不会被转义
  +  `"$ foo"`定义的字符串会将变量值进行替换。

+ **Bash支持定义函数**

  + 例子：创建一个文件夹并使用`cd`进入该文件夹

    ```bash
    mcd () {
        mkdir -p "$1"
        cd "$1"
    }
    ```

  + 其中一些变量

    + `$0` - 脚本名
    + `$1` 到 `$9` - 脚本的参数。 `$1` 是第一个参数，依此类推。
    + `$@` - 所有参数
    + `$#` - 参数个数
    + `$?` - 前一个命令的返回值
    + `$$` - 当前脚本的进程识别码
    + `!!` - 完整的上一条命令，包括参数。常见应用：当你因为权限不足执行命令失败时，可以使用 `sudo !!`再尝试一次。
    + `$_` - 上一条命令的最后一个参数。如果你正在使用的是交互式 shell，你可以通过按下 `Esc` 之后键入 . 来获取这个值。

+ 退出码可以搭配 `&&`（与操作符）和 `||`（或操作符）使用，用来进行条件判断，决定是否执行其他程序。程序 `true` 的返回码永远是`0`，`false` 的返回码永远是`1`

  + `a&&b` 成功执行了a才能执行b。例如在进行文件操作之前检查文件是否存在

  + `a||b` 执行失败a才会执行b

+ **命令替换和进程替换**

  + `$(CMD)`输出结果会替换掉 `$( CMD )` 
  + `<$(CMD)` 会执行 `CMD` 并将结果输出到一个临时文件中，并将 `<( CMD )` 替换成临时文件名。
  
+ **通配符**

  + `？`和`*`？表示任意**一个**字符，*表示任意长度字符
    + 例如，对于文件`foo`, `foo1`, `foo2`, `foo10` 和 `bar`, `rm foo?`这条命令会删除`foo1` 和 `foo2` ，而`rm foo*` 则会删除除了`bar`之外的所有文件。
  + `{}`当你有一系列的指令，其中包含一段公共子串时，可以用花括号来自动展开这些命令
    + convert image.{png,jpg}会展开为convert image.png image.jpg

+ **shebang** 它的作用是指定脚本文件中的解释器

  + 一般用使用 `env` 命令在 shebang 中是一种良好的实践，使得脚本更具通用性和可移植性。



#### shell工具

+ **查找命令的使用方法**

  + `man` 较为详细

  + `tldr`（Too Long; Didn’t Read）

    + 安装(ps:为什么不用apt-get:因为 tldr 并不是在官方Ubuntu软件仓库中的软件包，而是由社区维护的项目，因此，我们使用 npm（Node.js 包管理器）来安装它)

      + ```bash
        sudo apt update
        sudo apt install nodejs npm
        ```

        (ps: -g 选项会将 tldr 安装为全局命令，以便我们可以在终端中随时使用）

+ **查找文件**

  + `find` `find -name '*PATTERN*'` (如果希望模式匹配时是不区分大小写，可以使用`-iname`选项）

  ```BASH
  # 查找所有名称为src的文件夹
  find . -name src -type d
  # 查找所有文件夹路径中包含test的python文件
  find . -path '*/test/*.py' -type f
  # 查找前一天修改的所有文件
  find . -mtime -1
  # 查找所有大小在500k至10M的tar.gz文件
  find . -size +500k -size -10M -name '*.tar.gz'
  # 删除全部扩展名为.tmp 的文件
  find . -name '*.tmp' -exec rm {} \;
  # 查找全部的 PNG 文件并将其转换为 JPG
  find . -name '*.png' -exec convert {} {}.jpg \;
  ```

  + `fd`
  + `locate`

+ **查找代码**

  + `grep`
    + `-C` ：获取查找结果的上下文（Context）
    + `-v` 将对结果进行反选（Invert）
    +  `-R` 会递归地进入子目录并搜索所有的文本文件
  + `ack，rg，ag`等

+ **查找 shell 命令**

  + `history`： history | grep find 会打印包含find子串的命令
  + `Ctrl+R`
  + 基于历史命令的自动补全（待实现ing）

+ **文件夹导航**

  + `alias`：
    + [root@server1 ~]# alias la='ls -al'
    + 如果要永久使用，可以将该命令写入~/.bashrc文件里面。[root@server1 ~]# echo "alias la='ls -al'" >> ~/.bashrc

  + `fasd`
  + `autojump`



### 数据整理

#### 正则表达式

从代码、日志等文本中提取信息时非常有用 文件、电子表格，甚至文档。

1. 直接匹配
2. `\d`可以用来代替 *0 到 9 之间的任何数字*
3.  `*.*` （点） 表示 元字符，并且可以*匹配任何单个字符*（字母、数字、空格等）。你 可能会注意到，这实际上覆盖了句点字符的匹配，所以为了具体 匹配句点，您需要相应地使用斜杠 *\* 对点进行转义
4. `[abc]` 方括号，只会a、b、c匹配其中一个字符
5. `[^abc]`将匹配除字母 a、b 或 c *之外*的任何*单个*字符。
6. `-`当使用方括号表示法时，有一个用于匹配字符的速记 在连续字符列表中，使用*破折号*指示*字符*范围。例如 模式 *[0-6]* 将仅匹配从 0 到 6 的任何一位字符，而不匹配其他任何字符。 同样，*[^n-p]* 将只匹配除字母 n 到 p *之外*的任何单个字符。
7. `{}`此量词可以与任何字符或特殊元字符一起使用，例如 *w{3}* （three w's）、*[wxy]{5}*（五个字符，每个字符可以是 w、x 或 y）和 *.{2,6}*（介于两个和 *任何*字符的六个）
8. `+和*` 例如，匹配捐款 上面，我们可以使用模式 *\d* 来匹配任意数量的数字，但更紧密的正则表达式 将是 *\d+*，确保输入字符串至少有一个数字。这些量词可以与任何字符或特殊元字符一起使用，例如 *a+*（一个 或多个 a）、*[abc]+*（任何 a、b 或 c 字符中的一个或多个）和 .*（任何字符中的零个或多个）。
9.  `？` ab？c将 匹配字符串“abc”或“ac”，因为 b 被视为可选。与点元字符类似，问号是一个特殊字符，您必须使用斜杠 *\？* 对其进行转义，以匹配字符串中的普通问号字符。
10. `\s`正则表达式一起使用的最常见空格形式是*空格* （*␣*）、 *制表符* （\*t*）、*换行*符 （*\n*） 和回车符 （*\r*）（在 Windows 环境），并且这些特殊字符与它们各自的空格匹配。 此外，*空格*特殊字符 *\s* 将匹配*任何*特定的空格 在处理原始输入文本时非常有用。
11. `^和$`*开始和结束的模式* 使用特殊 *^*和 *$*元字符的行。在示例中 上面，我们可以使用模式*^success*来*只*匹配以“success”一词开头的一行
12. `()`一对括号内的任何子模式都将被*捕获*为一个组.您可以使用诸如 *^（IMG\d+\.png）$* 之类的模式来捕获和提取完整的 filename，但如果您只想捕获没有扩展名的文件名，则可以使用 模式 *^（IMG\d+）\.png*$，仅捕获句点之前的部分。

| 正则表达式   | 含义               |      |
| ------------ | ------------------ | ---- |
| \d           | 任意数字           |      |
| \D           | 任何非数字字符     |      |
| .            | 任何字符           |      |
| \.           | 时期               |      |
| [abc]        | 只有 a、b 或 c     |      |
| [^abc]       | 不是 a、b 也不是 c |      |
| [a-z]        | 字符 a 到 z        |      |
| [0-9]        | 数字 0 到 9        |      |
| \w           | 任何字母数字字符   |      |
| \W           | 任何非字母数字字符 |      |
| {m}          | m 重复             |      |
| {m，n}       | m 到 n 重复        |      |
| *            | 零次或多次重复     |      |
| +            | 一次或多次重复     |      |
| ?            | 可选字符           |      |
| \s           | 任何空格           |      |
| \S           | 任何非空格字符     |      |
| ^...$        | 开始和结束         |      |
| (...)        | 捕获组             |      |
| （一（BC）） | 捕获子组           |      |
| (.*)         | 捕获全部           |      |
| （abc\|def） | 匹配 abc 或 def    |      |

